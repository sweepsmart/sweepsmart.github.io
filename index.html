<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Sweep Smart</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap"
          rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Noto+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap"
          rel="stylesheet">

    <!-- D3.js -->
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
            integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
            integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
            integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
            crossorigin="anonymous"></script>

    <!-- Document script & stylesheet -->
    <link rel="stylesheet" href="style.css">
</head>

<body>
<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.14.5/firebase-app.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="https://www.gstatic.com/firebasejs/7.14.5/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.5/firebase-analytics.js"></script>

<script>
    // Your web app's Firebase configuration
    var firebaseConfig = {
        apiKey: "AIzaSyAWyTnF5M64rRPFJTzB9w0ZWYfq1M4Eo-4",
        authDomain: "sweep-smart.firebaseapp.com",
        databaseURL: "https://sweep-smart.firebaseio.com",
        projectId: "sweep-smart",
        storageBucket: "sweep-smart.appspot.com",
        messagingSenderId: "29730107897",
        appId: "1:29730107897:web:78bc5e5c54b84e7fe3cd28",
        measurementId: "G-6CW113RG53"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    //firebase.analytics();
    var database = firebase.database();
    var frequency_yes;
    var frequency_no;
    var ticket_yes;
    var ticket_no;


    var writeUserData = function (question, num_yes, num_no) {
        database.ref(question).set({
            yes: num_yes,
            no: num_no
        });
    };
    var readUserData = function () {
        database.ref().once("value").then(function(snapshot) {
            console.log(JSON.stringify(snapshot));
            frequency_yes = snapshot.child("frequency/yes").val();
            frequency_no = snapshot.child("frequency/no").val();
            ticket_yes = snapshot.child("ticket/yes").val();
            ticket_no = snapshot.child("ticket/no").val();
        })
    };

    readUserData();
</script>
<div id="splash">
    <h1>STREET SWEEPING HELPS KEEP THE CITY OF OAKLAND <span class="highlight">CLEAN</span>!</h1>
</div>
<img src="images/background.png">

<div id="stats" class="section_block">
    <h5><span class="header">1. Statistics</span></h5>
    <p>The Street Sweeping Unit is one of the most important units in the City of Oakland. It works to make sure the living
        environment in Oakland is clean and healthy. Street sweeping cleans streets in every corner of the city, even the most
        unvisited areas. </p>
    <h4>During 2019, <span class="highlight">20</span> operators in the Street Sweeping Department in the City of Oakland:</h4>
    <div class="container">
        <div class="row align-items-center graphical_content">
            <div class="col-12 col-sm-2 justify-content-center text-center">
                <p>Worked for</p>
            </div>
            <div class="col-12 col-sm-4 justify-content-center text-center">
                <img src="images/calendar.png" style="width: 75px">
                <p class="highlight">353</p>
                <p>days of cleaning</p>
            </div>
            <div class="col-12 col-sm-2 justify-content-center text-center">
                <h2>=</h2>
            </div>
            <div class="col-12 col-sm-4 justify-content-center text-center">
                <p><span class="highlight-secondary">97%</span> of calendar year</p>
                <p>day <span class="icon"><img src="images/day.png"></span> and night <span class="icon"><img
                        src="images/night.png"></span></p>
            </div>
        </div>
        <div class="row align-items-center graphical_content">
            <div class="col-12 col-sm-2 justify-content-center text-center">
                <p>Swept</p>
            </div>
            <div class="col-12 col-sm-4 justify-content-center text-center">
                <img src="images/road.png" style="width: 75px">
                <p class="highlight">44,800</p>
                <p>miles of road</p>
            </div>
            <div class="col-12 col-sm-2 justify-content-center text-center">
                <h2>=</h2>
            </div>
            <div class="col-12 col-sm-4 justify-content-center text-center">
                <p><span class="highlight-secondary">15.5</span> trips</p>
                <p><span class="icon"><img src="images/westcoast.png"></span><span class="icon"><img
                        src="images/path.png"></span><span class="icon"><img src="images/eastcoast.png"></span></p>
                <p>from the West Coast to East Coast</p>
            </div>
        </div>
        <div class="row align-items-center graphical_content">
            <div class="col-12 col-sm-2 justify-content-center text-center">
                <p>Cleaned</p>
            </div>
            <div class="col-12 col-sm-4 justify-content-center text-center">
                <img src="images/dump.png" style="width: 75px">
                <p class="highlight">1,530</p>
                <p>tons of garbage</p>
            </div>
            <div class="col-12 col-sm-2 justify-content-center text-center">
                <h2>=</h2>
            </div>
            <div class="col-12 col-sm-4 justify-content-center text-center">
                <p><span class="highlight-secondary">11,769</span></p>
                <p>standard household trash bins <span class="icon"><img src="images/trash.png"></span></p>
            </div>
        </div>
    </div>
</div>

<div class="section_block dark_block">
    <h1>However...</h1>
    <h4>Vehicles parked on the street during street sweeping hours make it impossible to complete the street sweeping
        activity.</h4>
    <div class="row align-items-end graphical_content">
        <div class="col-12 col-sm-5">
            <p>Therefore, parking violations are enforced during street sweeping hours to minimize interruption to street
                sweeping. However, there are still many vehicles blocking the streets during the scheduled street
                sweeping hours
                ...</p>
        </div>
        <div class="col-12 col-sm-7">
            <img src="images/illustration.png" style="max-width: 75%">
        </div>
    </div>
</div>

<div id="isotypes" class="section_block">
    <h5><span class="header">2. Ticket Facts</span></h5>
    <p>Street Sweeping parking violations account for the vast majority of parking tickets among all parking violation
        categories in 2019.</p>
    <div id="isotype_chart">
        <h3 class="ticket-bar-title" id="scroll-to">Number of Parking Tickets of Top 5 Parking Violation Types*</h3>
        <p></p>
        <table> 
            <tr><td>  </td> <td class="ticketIsotype"> <img src="images/parking_ticket.png"> = 1,000 parking tickets </td></tr>
            <tr>
        <td class="row-title"> Parking Violations </td>
        <td class="d3-animation"> 
            <svg id="isotype_bar" width="1200", height="900"></svg> <!-- TODO: Insert Isotype here-->
        <script>
            {

                $(window).scroll(function(event) {
                   var hT = $('#scroll-to').offset().top,
                       hH = $('#scroll-to').outerHeight(),
                       wH = $(window).height(),
                       wS = $(this).scrollTop();

                   if (wS > (hT+hH-wH)){
                    console.log("section 2 arrived.")
                       // Do some stuff here ..

                  const container = d3.select("#isotype_bar");
                  const imageLink = 'https://image.flaticon.com/icons/svg/708/708944.svg';
                  const imageHeight = 21
                 
                  
                  const Group1 = container
                        .append("g")
                        .attr("transform", () =>  "translate(" + 40 + "," + 20 + ")")
                        .attr("id", "pinkGroup")
                        .attr('fill', '#a6c72e')
                    
                  const Group2 = container
                        .append("g")
                        .attr("transform", () =>  "translate(" + 240 + "," + 20 + ")")
                        .attr("id", "greenGroup")
                        .attr("fill","dimgrey")
                  
                  const Group3 = container
                        .append("g")
                        .attr("transform", () =>  "translate(" + 440 + "," + 20 + ")")
                        .attr("id", "greenGroup")
                        .attr("fill","dimgrey")
                  
                  const Group4 = container
                        .append("g")
                        .attr("transform", () =>  "translate(" + 640 + "," + 20 + ")")
                        .attr("id", "greenGroup")
                        .attr("fill","dimgrey")
                  
                  const Group5 = container
                        .append("g")
                        .attr("transform", () =>  "translate(" + 840 + "," + 20 + ")")
                        .attr("id", "greenGroup")
                        .attr("fill","dimgrey")
                  
                   function init(svg, value, startX, startY, category, price) {
                    svg.attr("value", value);
                    
                    svg.append("text")
                       .attr("dy", startY - 30 - parseInt(value/5) * (imageHeight + 2))
                       .attr("dx", 50)
                       .attr("font-size", "25px")
                       .attr("font-family", "sans-serif")
                       .attr("text-anchor", "middle")
                       .attr("font-weight", "bold")
                       .text(value + ",000")
                     
                     svg.append("text")
                       .attr("dy", startY - 15 - parseInt(value/5) * (imageHeight + 2))
                       .attr("dx", 50)
                       .attr("font-size", "10px")
                       .attr("font-family", "sans-serif")
                       .attr("text-anchor", "middle")
                       .attr("font-weight", "bold")
                       .text("tickets")
                     
                     svg.append("text")
                         .attr("x", 50)
                         .attr("y", startY + 40)
                       .attr("font-size", "14px")
                       .attr("font-family", "sans-serif")
                       .attr("text-anchor", "middle")
                       .attr("font-weight", "bold")
                       .text(category.split(" ").slice(0, 3).join(" "))
                     
                     svg.append("text")
                         .attr("x", 50)
                         .attr("y", startY + 58)
                       .attr("font-size", "14px")
                       .attr("font-family", "sans-serif")
                       .attr("text-anchor", "middle")
                       .attr("font-weight", "bold")
                       .text(category.split(" ").slice(3, ).join(" "))
                     
                     svg.append("text")
                       .attr("dy", startY + 83)
                       .attr("dx", 50)
                       .attr("font-size", "10px")
                       .attr("font-family", "sans-serif")
                       .attr("text-anchor", "middle")
                       .attr("font-weight", "bold")
                       .attr("opacity", 0.7)
                       .text(price + "/ticket")
                     
                    // this is code to initialize the sequence of ticket in each pile
                    // we need a dataset of values to bind the tickets to, from 0 to value - 1
                    const arrayOfInts = d3.range(0,value);
                     
                    // this creates the ticket image pile
                    svg.selectAll("image")
                     .data(arrayOfInts)
                     .enter().append("image")
                     .attr('xlink:href', imageLink)
                     .attr("width", imageHeight)
                     .attr("height", imageHeight)
                     .attr("x", startX + 100 ) 
                     .attr("y", 50)
                     .attr("opacity", 0)
                     .transition()
                     .duration((d,i) => i*50)
                     .attr("x", d => 22 * (d % 5) ) 
                     .attr("y",  d => startY - parseInt(d/5) * (imageHeight + 2))
                     .attr("opacity", 1)
                     .attr("id", d => svg.attr("id") + "image" + d);
                   }
                  
                  
                 // call the initialization functions   
                 init(Group1, 158, 40, 750, "Parking during street sweeping hours", "$66");
                 init(Group2, 28, 240, 750, "Expired Meter", "$58");
                 init(Group3, 23, 440, 750, "Failure to display parking receipt", "$58");
                 init(Group4, 19, 640, 750, "Parking in Red Zone", "$83");
                 init(Group5, 8, 840, 750, "Parking in Residential Parking Permit Zone", "$83");

                 $(this).off(event);
                   }
                })
}
        </script>
        </td>
    </tr>
    </table>

    <p class="footnote2"> *Parking violation data based on Feb - Dec 2019 data from https://data.oaklandnet.com/dataset/Parking-Citations-2019/hzn4-3jp4 </p>
    </div>

</div>

<div class="section_block dark_block">
    <h1>Which areas are getting ticketed?</h1>
    <p>Street Sweeping parking violations are not evenly distributed across different neighborhoods. Some areas incur
        more street sweeping tickets than others. And the density of street sweeping tickets differs between day
        time and night time.</p>
</div>

<div id="heatmap" class="section_block">
    <h5><span class="header">3. Heatmap</span></h5>
    <p>A heat map of the number of street sweeping violation ticket issued in 2019. The darker the color, the more
        street sweeping tickets there are in the area.</p>
    <div class='tableauPlaceholder graphical_content' id='viz1588893359135' style='position: relative'>
        <noscript>
            <a href='#'>
                <img alt=' '
                     src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;St&#47;StreetSweepingViolationinOakland2019&#47;Sheet2&#47;1_rss.png'
                     style='border: none'/>
            </a>
        </noscript>
        <object class='tableauViz' style='display:none;'>
            <param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F'/>
            <param name='embed_code_version' value='3'/>
            <param name='path'
                   value='views&#47;StreetSweepingViolationinOakland2019&#47;Sheet2?:embed=y&amp;:display_count=y&amp;publish=yes'/>
            <param name='toolbar' value='yes'/>
            <param name='static_image'
                   value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;St&#47;StreetSweepingViolationinOakland2019&#47;Sheet2&#47;1.png'/>
            <param name='animate_transition' value='yes'/>
            <param name='display_static_image' value='yes'/>
            <param name='display_spinner' value='yes'/>
            <param name='display_overlay' value='yes'/>
            <param name='display_count' value='yes'/>
            <param name='filter' value='publish=yes'/>
        </object>
    </div>
    <script type='text/javascript'>
        var divElement = document.getElementById('viz1588893359135');
        var vizElement = divElement.getElementsByTagName('object')[0];
        vizElement.style.width = '100%';
        vizElement.style.height = (divElement.offsetWidth * 0.75) + 'px';
        var scriptElement = document.createElement('script');
        scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';
        vizElement.parentNode.insertBefore(scriptElement, vizElement);
    </script>
</div>

<div class="section_block dark_block">
    <h1>Why are some areas ticketed more?</h1>
    <p>Sometimes the ticket density is related to the street sweeping schedule. That is, the more frequently the
        street is swept, the the higher the number of street sweeping violations. However, that is not always
        the case.</p>
    <p>Let’s take a closer look at the scheduled street sweeping frequency and the ticket density in your
        neighborhood. </p>
</div>

<div id="maps" class="section_block">
    <h5><span class="header">4. Tickets Patterns</span></h5>
    <p>Is there any correlation between street sweeping frequency and the number of tickets? Can we find any patterns
        between them? Let's take a look at two maps of street sweeping frequency and ticket density.</p>
    <div class="container graphical_content">
        <div class="row align-items-end">
            <div class="col-8" style="text-align: center">
                <h3>Sweeping Frequency</h3>
                <p>This map shows the monthly frequency of sweeping routes. Notice certain regions are scheduled more frequently.<br>
                    Click around to explore the different neighborhoods!</p>
                <embed src="month_freq_h.png" width="650px" height="100%">
                <embed src="monthly_freq.html" width="100%" height="500px">
            </div>
            <!--<div class="col-1"></div>-->
            <div class="col-4 justify-content-center">
                <h5 style="color: #006632; font-weight: bold">What do you think?</h5>
                <p>My street is swept too often. </p>
                <button class="poll_btn btn btn-outline-success" id="sw_more">Yes</button>
                <button class="poll_btn btn btn-outline-success" id="sw_less">No</button>
                <svg id="pie_1" width="200" height="200"></svg>
                <div id="legend_block_1">
                    <p><span class="legend" style="background-color: #006632"></span>Yes</p>
                    <p><span class="legend" style="background-color: #BBD06E"></span>No</p>
                </div>

                <script>

                    var data1 = [];

                    var svg1 = d3.select("#pie_1"),
                        width = svg1.attr("width"),
                        height = svg1.attr("height"),
                        radius = Math.min(width, height) / 2,
                        g1 = svg1.append("g").attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

                    var color = d3.scaleOrdinal(['#006632', '#BBD06E']);

                    function change1() {
                        var pie1 = d3.pie();

                        var arc1 = d3.arc()
                            .innerRadius(0)
                            .outerRadius(80);

                        var arcs1 = g1.selectAll("arc")
                            .data(pie1(data1))
                            .enter()
                            .append("g")
                            .attr("class", "arc");

                        arcs1.append("path")
                            .attr("fill", function (d, i) {
                                return color(i);
                            })
                            .attr("d", arc1);

                        var labels1 = g1.selectAll("arc")
						  // .data(pie1(data_labels1))
						  .enter()
						  .append("text")
						  .text(function(d){ return ""+d.data})
						  .attr("transform", function(d) { return "translate(" + arc1.centroid(d) + ")";  })
						  .style("text-anchor", "middle")
						  .style("font-size", 5)
                    }

                    function bye_button1() {
                        sw_more.style.display = "none";
                        sw_less.style.display = "none";
                        legend_block_1.style.display = "block";
                    }

                    d3.select("button#sw_more")
                        .on("click", function () {
                            frequency_yes++;
                            data1[0] = frequency_yes;
                            data1[1] = frequency_no;
                            writeUserData("frequency", frequency_yes, frequency_no);
                            bye_button1();
                            change1();
                        });
                    d3.select("button#sw_less")
                        .on("click", function () {
                            frequency_no++;
                            data1[0] = frequency_yes;
                            data1[1] = frequency_no;
                            writeUserData("frequency", frequency_yes, frequency_no);
                            bye_button1();
                            change1();
                        })


                </script>
            </div>
        </div>

        <div class="row align-items-end graphical_content">
            <div class="col-8" style="text-align: center">
                <h3>Ticketing Patterns</h3>
                <p>Below we see the tickets issued during a month in 2019, color coded by tickets per mile. Warmer
                    colors indicate a higher density of tickets.</p>
                <embed src="cites_legend_h.png" width="500px" height="100%">
                <embed src="tickets_per_mile.html" width="100%" height="500px">
            </div>
            <!--<div class="col-1"></div> -->
            <div class="col-4 justify-content-center">
                <h5 style="color: #006632; font-weight: bold;">Does that surprise you?</h5>
                <p> My neighborhood received more street sweeping tickets than I thought. </p>

                <button class="poll_btn btn btn-outline-success" id="num_more"> Yes </button>
                <button class="poll_btn btn btn-outline-success" id="num_less"> No </button>
                <svg id="pie_2" width="200" height="200"></svg>
                <div id="legend_block_2">
                    <p><span class="legend" style="background-color: #006632"></span>Yes</p>
                    <p><span class="legend" style="background-color: #BBD06E"></span>No</p>
                </div>
<!--                <svg id="answer2"></svg>-->
                
                <script>
                    var data2 = [];

                    var svg2 = d3.select("#pie_2"),
                        width = svg2.attr("width"),
                        height = svg2.attr("height"),
                        radius = Math.min(width, height) / 2,
                        g2 = svg2.append("g").attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

                    var color = d3.scaleOrdinal(['#006632', '#BBD06E']);

                    function change2() {
                        var pie2 = d3.pie();

                        var arc2 = d3.arc()
                            .innerRadius(0)
                            .outerRadius(80);

                        var arcs2 = g2.selectAll("arc")
                            .data(pie2(data2))
                            .enter()
                            .append("g")
                            .attr("class", "arc")

                        arcs2.append("path")
                        	.attr("d", arc2)
                            .attr("fill", function (d, i) {
                                return color(i);
                            });

                        var labels2 = g2.selectAll("arc")
						  // .data(pie2(data_labels2))
						  .enter()
						  .append("text")
						  .text(function(d){ return ""+d.data})
						  .attr("transform", function(d) { return "translate(" + arc2.centroid(d) + ")";  })
						  .style("text-anchor", "middle")
						  .style("font-size", 5)

                    }

                    function bye_button2() {
                        num_more.style.display = "none";
                        num_less.style.display = "none";
                        legend_block_2.style.display = "block";
                    }

                    d3.select("button#num_more")
                        .on("click", function () {
                            ticket_yes++;
                            data2[0] = ticket_yes;
                            data2[1] = ticket_no;
                            writeUserData("ticket", ticket_yes, ticket_no);
                            bye_button2();
                            change2();
                        });
                    d3.select("button#num_less")
                        .on("click", function () {
                            ticket_no++;
                            data2[0] = ticket_yes;
                            data2[1] = ticket_no;
                            writeUserData("ticket", ticket_yes, ticket_no);
                            bye_button2();
                            change2();
                        })

                </script>
            </div>
        </div>
    </div>
</div>

<div id="conclusion" class="section_block dark_block">
    <h1>You have options!</h1>
    <h4>Do you think your neighborhood's sweeping schedule is unreasonable? You can request to change the street sweeping schedule! </h4>
    <div class="container graphical_content">
        <div class="row align-items-center">
            <div class="col-12 col-sm-6 justify-content-center text-center">
                <img src="images/broom.png" style="max-height: 85%">
                <p class="graphical_content">For more information about street sweeping services</p>
                <button type="button" class="btn btn-light btn-lg"
                        onclick="location.href='https://www.oaklandca.gov/topics/street-sweeping'">View More</button>
            </div>
            <div class="col-12 col-sm-6 justify-content-center text-center">
                <img src="images/calendars.png" style="max-height: 85%">
                <p class="graphical_content">To request a street sweeping schedule change</p>
                <button type="button" class="btn btn-light btn-lg"
                        onclick="location.href='https://www.oaklandca.gov/topics/street-sweeping-schedule-change'">View
                    More
                </button>
            </div>
        </div>
    </div>
</div>

<div class="footer section_block">
    <p>SweepSmart 2020</p>
    <p>UC-Berkeley School of Information, BCOT Team</p>
    <p>Created by: Yi Gai, Jessie Lyu, Anna Waldo, Tobey Yang</p>
    <p>All Rights Reserved</p>
</div>
</body>
</html>
